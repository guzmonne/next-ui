<!DOCTYPE html>
<html>
<head>
    <title>Example</title>
    <script type="text/javascript" src="lib/HighLightCode/beautify.js"></script>
    <script type="text/javascript" src="lib/HighLightCode/prettify.js"></script>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/nextui/ws/lib/jquery/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/DailyBuild/lastSuccessfulBuild/artifact/dest/next-core.js"></script>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/nextui/lastSuccessfulBuild/artifact/dest/js/next-ui.js"></script>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/UI_Component/lastSuccessfulBuild/artifact/dest/js/next-components.js"></script>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="http://d3js.org/topojson.v1.min.js"></script>
    <link rel="stylesheet" href="http://10.75.161.96:8080/jenkins/job/nextui/lastSuccessfulBuild/artifact/dest/css/next-blue.css"/>
    <script type="text/javascript" src="../../lib/GraphGenerator.js"></script>
    <link rel="stylesheet" href="../../src/less/next-graphic.css"/>
    <link rel="stylesheet" href="lib/HighLightCode/prettify.css"/>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/Next-graphic/lastSuccessfulBuild/artifact/dest/js/next-graphic.js"></script>
    <!--<script type="text/javascript" src="../../src/js/next-graphic.js"></script>-->


</head>
<body>
<style>

    html, body {
        height: 100%;
        width: 100%;
        padding: 0px;
        margin: 0px;
        /*overflow: hidden;*/
    }

    #demos {
        height: 100%;
    }

    .row {
        position: relative;
        height: inherit;
    }

    .prev {
    }

    .prev {
        height: 100%;
    }

    .demoContainer {
        height: 100%;
    }

    .demoContainer > div {
        top: 45px;
        bottom: 94px;
        left: 0;
        right: 0;
        position: absolute;
    }
</style>
<br/>

<h1>Topology</h1>

<div id="demos"></div>

<script type="text/javascript">

var topo;

var Demo = nx.define(nx.ui.Component, {
    properties: {
        categories: {
            value: function () {
                return new nx.data.ObservableDictionary();
            }
        },
        currentItem: null,
        currentConfig: null,
        jsfiles: {
            value: function () {
                return new nx.data.ObservableDictionary();
            }
        }
    },
    view: {
        props: {
            'class': 'row'
        },
        content: [
            {
                props: {
                    items: '{#jsfiles}',
                    template: {
                        tag: 'script',
                        props: {
                            'type': 'text/javascript',
                            'data-demo-name': '{key}',
                            src: '{value}'
                        }
                    }
                }
            },
            {
                props: {
                    'class': 'col-md-3'
                },
                content: {
                    props: {
                        items: '{#categories}',
                        template: {
                            props: {
                                'class': 'panel panel-default'
                            },
                            content: [
                                {
                                    props: {
                                        'class': 'panel-heading'
                                    },
                                    content: '{key}'

                                },
                                {
                                    props: {
                                        'class': 'list-group',
                                        items: '{value}',
                                        template: {
                                            tag: 'a',
                                            props: {
                                                'class': 'list-group-item'
                                            },
                                            content: '{itemLabel}',
                                            events: {
                                                'click': '{#_load}'
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                }
            },
            {
                name: 'prev',
                props: {
                    'class': 'col-md-9 prev'
                },
                content: [
                    {
                        tag: 'ul',
                        props: {
                            'class': 'nav nav-tabs nav-justified'

                        },
                        content: [
                            {
                                tag: 'li',
                                props: {
                                    'class': 'active'
                                },
                                content: {
                                    tag: 'a',
                                    content: 'Demo'
                                }
                            },
                            {
                                tag: 'li',
                                props: {
                                    'class': ''
                                },
                                content: {
                                    tag: 'a',
                                    content: 'Code'
                                }
                            }
                        ]
                    },
                    {
                        name: 'demo',
                        props: {
                            'class': 'demoContainer'
                        }
                    },
                    {
                        name: 'code',
                        tag: 'pre',
                        props: {
                            'class': 'prettyprint lang-js'
                        }
                    }
                ]
            }
        ]
    },
    methods: {
        init: function (args) {
            this.inherited(args);
            this.addItem({
                categoryName: 'Basic',
                itemKey: 'base',
                itemLabel: 'Base',
                files: ['basic/base.js'],
                itemClass: 'Base.Base'
            });

            this.addItem({
                categoryName: 'Basic',
                itemKey: 'autolayout',
                itemLabel: 'Auto Layout',
                files: ['basic/autolayout.js'],
                itemClass: 'Base.AutoLayout'
            });


            this.addItem({
                categoryName: 'Basic',
                itemKey: 'customize',
                itemLabel: 'Customize Link and Node',
                files: ['basic/customize.js'],
                itemClass: 'Base.Customize'
            });

            this.addItem({
                categoryName: 'Basic',
                itemKey: 'highlight',
                itemLabel: 'Highlight Link and Node',
                files: ['basic/highlight.js'],
                itemClass: 'Base.Highlight'
            });


            this.addItem({
                categoryName: 'NodeSet',
                itemKey: 'base',
                itemLabel: 'NodeSet',
                files: ['nodeset/base.js'],
                itemClass: 'NodeSet.Base'
            });


            this.addItem({
                categoryName: 'NodeSet',
                itemKey: 'hierarchy',
                itemLabel: 'Hierarchy NodeSet (issue)',
                files: ['nodeset/hierarchy.js'],
                itemClass: 'NodeSet.Hierarchy'
            });

            this.addItem({
                categoryName: 'NodeSet',
                itemKey: 'aggregation',
                itemLabel: 'Aggregation NodeSet (issue)',
                files: ['nodeset/aggregation.js'],
                itemClass: 'NodeSet.Aggregation'
            });

            this.addItem({
                categoryName: 'Group',
                itemKey: 'base',
                itemLabel: 'Add group',
                files: ['group/base.js'],
                itemClass: 'Group.Base'
            });

            this.addItem({
                categoryName: 'Layer',
                itemKey: 'define',
                itemLabel: 'Define a customised Layer',
                files: ['layer/define.js'],
                itemClass: 'Layer.Define'
            });

            this.addItem({
                categoryName: 'Layer',
                itemKey: 'api',
                itemLabel: 'Interaction with layer',
                files: ['layer/api.js'],
                itemClass: 'Layer.API'
            });


            this.addItem({
                categoryName: 'Path',
                itemKey: 'base',
                itemLabel: 'Add path',
                files: ['path/base.js'],
                itemClass: 'Path.Base'
            });

            this.addItem({
                categoryName: 'Path',
                itemKey: 'multiple',
                itemLabel: 'Add multiple path',
                files: ['path/multiple.js'],
                itemClass: 'Path.Multiple'
            });

            this.addItem({
                categoryName: 'Path',
                itemKey: 'traffic',
                itemLabel: 'Add traffic path',
                files: ['path/traffic.js'],
                itemClass: 'Path.Traffic'
            });

            this.addItem({
                categoryName: 'Map',
                itemKey: 'us',
                itemLabel: 'US Map',
                files: ['map/us.js'],
                itemClass: 'Map.US'
            });

            this.addItem({
                categoryName: 'Map',
                itemKey: 'world',
                itemLabel: 'World Map',
                files: ['map/world.js'],
                itemClass: 'Map.World'
            });

            this.addItem({
                categoryName: 'Layout',
                itemKey: 'force',
                itemLabel: 'Force Layout',
                files: ['layout/force.js'],
                itemClass: 'Layout.Force'
            });

            this.addItem({
                categoryName: 'Extend',
                itemKey: 'link',
                itemLabel: 'Extend Link',
                files: ['extend/link.js'],
                itemClass: 'Extend.Link'
            });

            this.addItem({
                categoryName: 'Extend',
                itemKey: 'icon',
                itemLabel: 'Add node icon',
                files: ['extend/icon.js'],
                itemClass: 'Extend.Icon'
            });

            setTimeout(function () {
                this._parseURL();
            }.bind(this), 200);

        },
        _parseURL: function () {
            var url = window.location.href.split("#");
            if (url[1]) {
                var params = url[1].split("/");
                var category = params[0];
                var itemkey = params[1];

                if (category && itemkey) {

                    var items;
                    this.categories().each(function (c, key) {
                        if (key == category) {
                            items = c.value;
                        }
                    });

                    items.each(function (item) {
                        if (item.itemKey == itemkey) {
                            this.loadDemo(item);
                        }
                    }, this);
                }
            }
        },
        addItem: function (config) {
            //category, name, url, className
            var categories = this.categories();
            if (!categories.contains(config.categoryName)) {
                categories.setItem(config.categoryName, new nx.data.ObservableCollection());
            }
            var items = categories.getItem(config.categoryName);
            items.add(config);

            var files = config.files;
            nx.each(nx.is(files, 'Array') ? files : [files], function (u) {
                this.jsfiles().setItem(config.categoryName + '-' + config.itemKey, u);
            }, this);
        },
        _load: function (sender, event) {
            this.loadDemo(sender.model());
        },
        loadDemo: function (config) {

            var clz = config.itemClass;
            if (nx.is(config.itemClass, 'String')) {
                clz = nx.path(nx.global, clz);
            }
            if (this.currentItem()) {
                this.currentItem().dispose();
            }

            var demo = new clz();
            demo.attach(this.resolve('demo'));

            if (demo.resolve('topo')) {
                topo = demo.resolve('topo');
            }

            this.currentItem(demo);
            this.currentConfig(config);
            var siteRootUrl = window.location.href.split("#").shift();
            window.location.href = siteRootUrl + '#' + '' + config.categoryName + '/' + config.itemKey;

            this._loadCode();

        },
        _loadCode: function () {
            var config = this.currentConfig();
            var file = config.files[0];
            $.get(file, function (d) {
                var c = js_beautify(d, {
                    preserve_newlines: false
                });
                this.view('code').content(null);
                this.view('code').content(c);
                prettyPrint();
            }.bind(this));
            //
        }
    }
});


var App = nx.define(nx.ui.Application, {
    methods: {
        getContainer: function () {
            return new nx.dom.Element(document.getElementById('demos'));
        },
        start: function () {
            var demo = new Demo();
            demo.attach(this);


        }
    }
});

var app = new App();
app.on('resize', function () {
    topo.adaptToContainer();
});
app.start();

</script>
</body>
</html>