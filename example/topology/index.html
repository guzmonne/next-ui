<!DOCTYPE html>
<html>
<head>
    <title>Example</title>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/DailyBuild/lastSuccessfulBuild/artifact/dest/next-core.js"></script>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/nextui/lastSuccessfulBuild/artifact/dest/js/next-ui.js"></script>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/UI_Component/lastSuccessfulBuild/artifact/dest/js/next-components.js"></script>
    <link rel="stylesheet" href="http://10.75.161.96:8080/jenkins/job/nextui/lastSuccessfulBuild/artifact/dest/css/next-blue.css"/>
    <script type="text/javascript" src="../../lib/GraphGenerator.js"></script>
    <script type="text/javascript" src="../../src/js/next-graphic.js"></script>
    <link rel="stylesheet" href="../../src/less/next-graphic.css"/>

</head>
<body>
<style>

    body, html {
        height: 100%;
        width: 100%;
    }

    #demos,
    .row,
    .prev {
        height: 100%;
    }

    .prev > div {
        top: 0px;
        bottom: 0px;
        left: 0;
        right: 0;
        /*height: 100px;*/
        position: absolute;
    }
</style>
<h1>Topology</h1>

<div id="demos"></div>

<script type="text/javascript">

var topo;

var Demo = nx.define(nx.ui.Component, {
    properties: {
        categories: {
            value: function () {
                return new nx.data.ObservableDictionary();
            }
        },
        currentItem: null,
        jsfiles: {
            value: function () {
                return new nx.data.ObservableDictionary();
            }
        }
    },
    view: {
        props: {
            'class': 'row'
        },
        content: [
            {
                props: {
                    items: '{#jsfiles}',
                    template: {
                        tag: 'script',
                        props: {
                            'type': 'text/javascript',
                            'data-demo-name': '{key}',
                            src: '{value}'
                        }
                    }
                }
            },
            {
                props: {
                    'class': 'col-md-3'
                },
                content: {
                    props: {
                        items: '{#categories}',
                        template: {
                            props: {
                                'class': 'panel panel-default'
                            },
                            content: [
                                {
                                    props: {
                                        'class': 'panel-heading'
                                    },
                                    content: '{key}'

                                },
                                {
                                    props: {
                                        'class': 'list-group',
                                        items: '{value}',
                                        template: {
                                            tag: 'a',
                                            props: {
                                                'class': 'list-group-item'
                                            },
                                            content: '{itemLabel}',
                                            events: {
                                                'click': '{#_load}'
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                }
            },
            {
                name: 'prev',
                props: {
                    'class': 'col-md-9 prev'
                }
            }
        ]
    },
    methods: {
        init: function (args) {
            this.inherited(args);
            this.addItem({
                categoryName: 'Basic',
                itemKey: 'base',
                itemLabel: 'Base',
                files: ['basic/base.js'],
                itemClass: 'Base.Base'
            });

            this.addItem({
                categoryName: 'Basic',
                itemKey: 'autolayout',
                itemLabel: 'Auto Layout',
                files: ['basic/autolayout.js'],
                itemClass: 'Base.AutoLayout'
            });


            this.addItem({
                categoryName: 'Basic',
                itemKey: 'customize',
                itemLabel: 'Customize Link and Node',
                files: ['basic/customize.js'],
                itemClass: 'Base.Customize'
            });


            this.addItem({
                categoryName: 'NodeSet',
                itemKey: 'base',
                itemLabel: 'NodeSet',
                files: ['nodeset/base.js'],
                itemClass: 'NodeSet.Base'
            });

            console.log(this.categories());

            // this.addItem('Basic', 'Auto Layout', 'basic/autolayout.js', 'Base.AutoLayout');
            setTimeout(function () {
                this._parseURL();
            }.bind(this), 200);

        },
        _parseURL: function () {
            var url = window.location.href.split("#");
            if (url[1]) {
                var params = url[1].split("/");
                var category = params[0];
                var itemkey = params[1];

                if (category && itemkey) {

                    var items;
                    this.categories().each(function (c, key) {
                        if (key == category) {
                            items = c.value;
                        }
                    });

                    items.each(function (item) {
                        if (item.itemKey == itemkey) {
                            this.loadDemo(item);
                        }
                    }, this);
                }
            }
        },
        addItem: function (config) {
            //category, name, url, className
            var categories = this.categories();
            if (!categories.contains(config.categoryName)) {
                categories.setItem(config.categoryName, new nx.data.ObservableCollection());
            }
            var items = categories.getItem(config.categoryName);
            items.add(config);

            var files = config.files;
            nx.each(nx.is(files, 'Array') ? files : [files], function (u) {
                this.jsfiles().setItem(config.categoryName + '-' + config.itemKey, u);
            }, this);
        },
        _load: function (sender, event) {
            this.loadDemo(sender.model());
        },
        loadDemo: function (config) {

            var clz = config.itemClass;
            if (nx.is(config.itemClass, 'String')) {
                clz = nx.path(nx.global, clz);
            }
            if (this.currentItem()) {
                this.currentItem().dispose();
            }

            var demo = new clz();
            demo.attach(this.resolve('prev'));

            if (demo.resolve('topo')) {
                topo = demo.resolve('topo');
            }

            this.currentItem(demo);
            var siteRootUrl = window.location.href.split("#").shift();
            window.location.href = siteRootUrl + '#' + '' + config.categoryName + '/' + config.itemKey;
        }
    }
});


var App = nx.define(nx.ui.Application, {
    methods: {
        getContainer: function () {
            return new nx.dom.Element(document.getElementById('demos'));
        },
        start: function () {
            var demo = new Demo();
            demo.attach(this);
        }
    }
});

var app = new App();
app.start();

</script>
</body>
</html>