<!DOCTYPE html>
<html>
<head>
    <title>Example</title>
    <link rel="stylesheet" href="http://10.75.161.96:8080/jenkins/job/nextui/lastSuccessfulBuild/artifact/dest/css/next-blue.css"/>
    <link rel="stylesheet" href="http://10.75.161.96:8080/jenkins/job/Next-graphic/ws/src/less/next-graphic.css"/>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/DailyBuild/lastSuccessfulBuild/artifact/dest/next-core.js"></script>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/nextui/lastSuccessfulBuild/artifact/dest/js/next-ui.js"></script>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/Next-graphic/ws/lib/GraphGenerator.js"></script>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/nextui/ws/lib/jquery/jquery-1.10.2.min.js"></script>
    <script src="http://10.75.161.96:8080/jenkins/job/Next-graphic/ws/lib/bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript" src="http://10.75.161.96:8080/jenkins/job/Next-graphic/lastSuccessfulBuild/artifact/dest/js/next-graphic.js"></script>
    <!--<script type="text/javascript" src="../../../src/js/next-graphic.js"></script>-->
    <script src="data.js"></script>


</head>
<style>
    html, body {
        height: 100%;
        width: 100%;
    }

    #topo, #list {
        height: 100%;
    }
</style>
<body>


<div id="topo" class="col-md-10"></div>
<div id="list" class="col-md-2" style="padding: 20px; border-left: solid 1px #ccc">

    <span>Node Label</span>

    <div class="btn-group" style="display: inline-block; width: 120px; margin-left: 12px;">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            ID <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu" id="labels">
            <li><a href="#" value="role">Role</a></li>
            <li><a href="#" value="id">ID</a></li>
            <li><a href="#" value="label">Label</a></li>
        </ul>
    </div>


</div>


<script type="text/javascript">


    var topo = new nx.graphic.Topology({
        adaptive: true,
        identityKey: 'id',
        nodeConfig: {
            label: 'model.id',
            iconType: 'model.deviceType'
        },
        nodeSetConfig: {
            label: 'model.id',
            iconType: 'model.iconType'
        },
        showIcon: true,
        theme:'yellow',
        data: topologyData
    });


    nx.define("NodeSetScene", nx.graphic.Topology.DefaultScene, {
        methods: {
            expandNodeSet: function (sender, nodeSet) {
                this.inherited(sender, nodeSet);


                var node = topo.getNode(nodeSet.model().get('nodeID'));


                if (!node.dot) {
                    var dot = new nx.graphic.Icon({
//                            y: -30,
                        iconType: "collapse"
                    });
                    dot.attach(node);
                    node.dot = dot;
                    dot.on('click', function () {
                        nodeSet.collapsed(true);
                    });


                }


//                    var bound = this._topo.getBoundByNodes(nodeSet.getNodes());
//                    this._topo.zoomByBound(bound, function () {
//                        this._topo._setProjection(true);
//                    }.bind(this));

                this._topo.zoomByNodes(nodeSet.getNodes());


            },
            collapseNodeSet: function (sender, nodeSet) {
                nodeSet.visible(true);
            }
        }


    });

    topo.registerScene('nodeset', 'NodeSetScene');
    topo.activateScene('nodeset');
    var app = new nx.ui.Application();
    app.container(document.getElementById('topo'));
    topo.attach(app);


    $(function () {
        $('#labels a').click(function () {
            var value = $(this).attr('value');
            topo.eachNode(function (node) {
                nx.util.setProperty(node, 'label', 'model.' + value);
            })
        })
    })

</script>


</body>
</html>